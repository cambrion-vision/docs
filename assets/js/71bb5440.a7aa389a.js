"use strict";(self.webpackChunkcambrion_doc=self.webpackChunkcambrion_doc||[]).push([[397],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),m=o,h=c["".concat(l,".").concat(m)]||c[m]||d[m]||r;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:o,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9043:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=n(7462),o=(n(7294),n(3905));const r={description:"Organizing results with observations",sidebar_position:3},i="Handling results",s={unversionedId:"pipelines/observations",id:"pipelines/observations",title:"Handling results",description:"Organizing results with observations",source:"@site/docs/pipelines/observations.md",sourceDirName:"pipelines",slug:"/pipelines/observations",permalink:"/docs/pipelines/observations",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/pipelines/observations.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{description:"Organizing results with observations",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Link business data",permalink:"/docs/pipelines/linker"},next:{title:"Use-cases",permalink:"/docs/category/use-cases"}},l={},p=[{value:"Structure of the observation",id:"structure-of-the-observation",level:2},{value:"Retrieving the full observation",id:"retrieving-the-full-observation",level:2},{value:"Observation as simple JSON",id:"observation-as-simple-json",level:2},{value:"Custom transformation of an observation",id:"custom-transformation-of-an-observation",level:2},{value:"Bootstrapping an observation",id:"bootstrapping-an-observation",level:2}],u={toc:p},c="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(c,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"handling-results"},"Handling results"),(0,o.kt)("p",null,"Document contents are typically highly complex. Especially when you want to incorporate layout information in the pipeline calculations. To efficiently handle document contents we introduced a specific data structure named ",(0,o.kt)("strong",{parentName:"p"},"observation"),"."),(0,o.kt)("p",null,"We modeled the structure of the observation with that in mind. There is a number of things that can be represented with an observation:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Layout information data (like location)"),(0,o.kt)("li",{parentName:"ul"},"Structural relations (like key-value pairs and tables)"),(0,o.kt)("li",{parentName:"ul"},"Attaching business data to text entities"),(0,o.kt)("li",{parentName:"ul"},"Quality measures (text recognition confidence, similarity to business data)"),(0,o.kt)("li",{parentName:"ul"},"Semantic information (text entity labels)")),(0,o.kt)("p",null,"The definition of the observation is part of ",(0,o.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/cambrion-vision/api-sepc/main/cambrion_api.yaml"},"Open API Spec"),"."),(0,o.kt)("p",null,"As the observation is mainly used as carrier of results of a pipeline call, the underlying pipeline and its design are responsible for filling the observation with data. "),(0,o.kt)("h2",{id:"structure-of-the-observation"},"Structure of the observation"),(0,o.kt)("p",null,"Let's explore the observation in detail. As mentioned earlier it's a data structure that is used to store information extracted from one more document pages. The observation can be composed by three fundamental objects:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Entity"),": An entity is an object that describes a block of text and it's assoicitaed meta data. The meta data can contain",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"The location (bounding box) of the text"),(0,o.kt)("li",{parentName:"ul"},"Quality scores"),(0,o.kt)("li",{parentName:"ul"},"Label"),(0,o.kt)("li",{parentName:"ul"},"Type: can indicate the semantic meaning of the entity (number, string, date, quantity, unit, percentage)"),(0,o.kt)("li",{parentName:"ul"},"Associated data: the data field can hold the parsed values (e.g. converted string to actual date), data associated by the linker (e.g. a field in an indexed document, the ID of the linked document, field name etc.)"),(0,o.kt)("li",{parentName:"ul"},"Embedding: a vector the represents the entity in vector space"),(0,o.kt)("li",{parentName:"ul"},"Similarity: the similarity between the associated data and parsed value of the entity"),(0,o.kt)("li",{parentName:"ul"},'Layout type: wether the entity represents a single word ("WORD") or a number of connected words ("LINE")'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Key value set"),': A set of key value pairs. A key value pair represents a semantic association between a key entity (e.g. the word "Date: " before the actual date) and a value entity (e.g. the word "03/05/2021"). The value entity can also be a nested key value set or a table (see below).'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Table"),": A table is a set of of key value sets (the rows of the table). The headers field can be used to model the headers of a table as an array of entities.")),(0,o.kt)("p",null,"The recursive nature of the observation enables the modelling of vastly different document layouts."),(0,o.kt)("h2",{id:"retrieving-the-full-observation"},"Retrieving the full observation"),(0,o.kt)("p",null,"As an observation is mainly used to used to represent the results of pipeline it is either directly returned from a pipeline call or is attached to an ",(0,o.kt)("a",{parentName:"p",href:"./executions"},"execution")," on which the the pipeline was executed."),(0,o.kt)("p",null,"Here is an example how to retrieve the observation from an existing execution with ID ",(0,o.kt)("inlineCode",{parentName:"p"},"my-execution-id"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"import requests\n\nCAMBRION_API_KEY = \"INSERT_API_KEY\"\nheaders = {\n  'Accept': 'application/json',\n  'Content-Type': 'application/json',\n  'X-API-Key': CAMBRION_API_KEY\n}\n\nurl = \"https://api.cambrion.io/v1/executions/my-execution-id/observation\"\n\nresponse = requests.request(\"POST\", url, headers=headers)\n\nobservation = response.json()\n")),(0,o.kt)("h2",{id:"observation-as-simple-json"},"Observation as simple JSON"),(0,o.kt)("p",null,"Sometimes you are not interested in layout information from the extracted data and just want to recieve the corresponding JSON object. We provide an endpoint for doing just that:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"import requests\n\nCAMBRION_API_KEY = \"INSERT_API_KEY\"\nheaders = {\n  'Accept': 'application/json',\n  'Content-Type': 'application/json',\n  'X-API-Key': CAMBRION_API_KEY\n}\n\nurl = \"https://api.cambrion.io/v1/executions/my-execution-id/observation/json\"\n\nresponse = requests.request(\"POST\", url, headers=headers)\n\njson_result = response.json()\n")),(0,o.kt)("p",null,"The resulting JSON object is converted from the underlying observation by using the data field from each entity."),(0,o.kt)("h2",{id:"custom-transformation-of-an-observation"},"Custom transformation of an observation"),(0,o.kt)("p",null,"In real-life use-cases it's sometimes tedious to map the observation to business objects. Therefore we integrated ",(0,o.kt)("a",{parentName:"p",href:"https://docs.jsonata.org"},"JSONata")," into the observation API. This was a natural fit since the observation is just a complex JSON object."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import requests\n\nCAMBRION_API_KEY = "INSERT_API_KEY"\nheaders = {\n  \'Accept\': \'application/json\',\n  \'Content-Type\': \'application/json\',\n  \'X-API-Key\': CAMBRION_API_KEY\n}\n\nurl = "https://api.cambrion.io/v1/executions/my-execution-id/observation/transform"\n\ntransform = "{\\"name\\": **.entities[label = \\"name\\"].block.text,\\"quantity\\": **.entities[label = \\"qty\\"].data.quantityValue,\\"weight\\": **.entities[label = \\"weight\\"].data.numberValue}"\n\nresponse = requests.request("POST", url, data=transform, headers=headers)\n')),(0,o.kt)("p",null,"Using JSONata we easily transform an observation into the required business representation. JSONata features a lot of built-in operators:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"regular expressions"),(0,o.kt)("li",{parentName:"ul"},"date time conversions"),(0,o.kt)("li",{parentName:"ul"},"path operators "),(0,o.kt)("li",{parentName:"ul"},"functions and expressions")),(0,o.kt)("p",null,"And much more..."),(0,o.kt)("p",null,"The full JSONata reference can be found here: ",(0,o.kt)("a",{parentName:"p",href:"https://docs.jsonata.org/overview.html"},"https://docs.jsonata.org/overview.html"),"\nNote that it can be useful to use the JSONata exerciser (",(0,o.kt)("a",{parentName:"p",href:"https://try.jsonata.org"},"https://try.jsonata.org"),") to prototype a JSONata expression. For that you can fetch the observation via the API and then copy and paste the observation into the left field of the exerciser and test your expressions on it."),(0,o.kt)("h2",{id:"bootstrapping-an-observation"},"Bootstrapping an observation"),(0,o.kt)("p",null,"It can be useful to provide document content to a pipeline. For example removing the OCR step from a pipeline and providing recognized text from other sources can greatly improve the run times of a pipeline."),(0,o.kt)("p",null,"This can be done by creating the the observation object manually and add it to an execution. Running the pipeline on the created execution will use the provided observation the perform the calculations."))}d.isMDXComponent=!0}}]);